# Example of calling this file would be:
# bqn netTest.bqn server 43 132 10 140

# 43 132 10 140 is just an example I made up.
# For testing, you should use your own local address,
# on linux you can see this with the command:
# hostname -i

# It should print the port to connect to,
# which you use in this command, where you replace 42597 with your port:
# bqn netTest.bqn client 43 132 10 140 42597


# This example is similar to netTest.bqn,
# except it uses a few modifiers to attempt to simplify.

_asClientâ€¿_asServer â† â€¢Import "socket.bqn"

{"server"â€¿aâ€¿ddâ€¿reâ€¿ss:
  address â† â€¢ParseFloatÂ¨ aâ€¿ddâ€¿reâ€¿ss
  {ğ•Šserver:
    â€¢Out "server is on port "âˆ¾â€¢Repr server.port
    {ğ•Šconnection:
      port â† â€¢ParseFloat connection.Listen@
      {ğ•Šclient:
        client.Send â€¢Show "hi from server"
        â€¢Show connection._withMessage_ (â€¢Delayâˆ˜0.1âŠ¸âŠ¢) â€¢_While_ (@âŠ¸â‰¡)@
      }_asClientÂ´ addressâ€¿port
    } server._WithConnection_ (â€¢Delayâˆ˜0.1âŠ¸âŠ¢) â€¢_While_ (@âŠ¸â‰¡)@
  } _asServer@
;"client"â€¿aâ€¿ddâ€¿reâ€¿ssâ€¿portStr:
  address â† â€¢ParseFloatÂ¨ aâ€¿ddâ€¿reâ€¿ss
  port â† â€¢ParseFloat portStr
  {ğ•Šclient:
    {ğ•Šserver:
      â€¢Out "server is on port "âˆ¾â€¢Repr server.port
      client.Send â€¢Repr server.port
      {ğ•Šconnection:
        â€¢Show connection.Listen@
        client.Send â€¢Show "hi from client"
      } server._WithConnection_ (â€¢Delayâˆ˜0.1âŠ¸âŠ¢) â€¢_While_ (@âŠ¸â‰¡)@
    }_asServer@
  } _asClientÂ´addressâ‹ˆport
} â€¢args
